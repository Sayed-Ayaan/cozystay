<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hotel Booking Form</title>
  <link rel="stylesheet" href="form.css" />
  <link rel="stylesheet" href="header.css" />
</head>

<body>
  <header>
    <div class="container">
      <h1 id="heading">CozyStays Hotel</h1>
      <nav>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="rooms.html">Rooms</a></li>
          <li><a href="amenities.html">Amenities</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="booking-form-container">
    <h1>Find Your Perfect Stay</h1>
    <form id="bookingForm" class="booking-form" method="POST">
      <!-- Full Name -->
      <div class="form-row">
        <div class="form-group">
          <label for="name">Full Name</label>
          <input class="form-input" type="text" id="name" name="name" placeholder="Your full name" required />
        </div>
      </div>

      <!-- Phone -->
      <div class="form-row">
        <div class="form-group">
          <label for="phone">Phone Number</label>
          <input class="form-input" type="tel" id="phone" name="phone" placeholder="9999999999"
            pattern="^(\+91[\-\s]?|0)?[6-9]\d{9}$" required />
        </div>
      </div>

      <!-- Dates -->
      <div class="form-row">
        <div class="form-group">
          <label for="checkin">Check-in Date</label>
          <input class="form-input" type="date" id="checkin" name="checkin" required />
        </div>
        <div class="form-group">
          <label for="checkout">Check-out Date</label>
          <input class="form-input" type="date" id="checkout" name="checkout" required />
        </div>
      </div>

      <!-- Room Quantities -->
      <div class="form-row">
        <div class="form-group">
          <label for="deluxeRooms">Deluxe Rooms</label>
          <input class="form-input" type="number" id="deluxeRooms" name="deluxeRooms" min="0" value="0" required />
        </div>

        <div class="form-group">
          <label for="suiteRooms">Executive Suites</label>
          <input class="form-input" type="number" id="suiteRooms" name="suiteRooms" min="0" value="0" required />
        </div>

        <div class="form-group">
          <label for="standardRooms">Standard Rooms</label>
          <input class="form-input" type="number" id="standardRooms" name="standardRooms" min="0" value="0" required />
        </div>
      </div>

      <button type="submit">Book Room</button>
    </form>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2025 CozyStays Hotel. All rights reserved.</p>
    </div>
  </footer>

  <script>
    document.getElementById('bookingForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const name = document.getElementById('name').value;
      const phone = document.getElementById('phone').value;
      const checkin = document.getElementById('checkin').value;
      const checkout = document.getElementById('checkout').value;
      const deluxeRooms = document.getElementById('deluxeRooms').value;
      const suiteRooms = document.getElementById('suiteRooms').value;
      const standardRooms = document.getElementById('standardRooms').value;

      if (new Date(checkout) <= new Date(checkin)) {
        alert("Check-out date must be after check-in date!");
        return;
      }

      // Send booking to server
      try {
        const res = await fetch('/book-room', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name,
            phone,
            checkin,
            checkout,
            deluxeRooms,
            suiteRooms,
            standardRooms
          })
        });

        const data = await res.json();

        if (res.ok) {
         alert('Booking successful!'); 
          // Redirect to receipt page with query params
          const nights = Math.ceil((new Date(checkout) - new Date(checkin)) / (1000 * 60 * 60 * 24));
          const query = new URLSearchParams({
            name,
            checkin,
            checkout,
            deluxeRooms,
            suiteRooms,
            standardRooms,
            nights
          }).toString();

          window.location.href = `receipt.html?${query}`;
        } else {
          alert(data.error || 'Booking failed!');
        }
      } catch (err) {
        console.error(err);
        alert('Error connecting to server');
      }
    });
  </script>

</body>

</html>